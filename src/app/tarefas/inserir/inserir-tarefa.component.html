<div class="row h-100 align-items-start justify-content-start">
  <section class="d-grid gap-2 col-sm col-lg-6 col-xxl-7">
    <app-titulo-pagina icone="add">Cadastro de Tarefas</app-titulo-pagina>
    <app-descricao-pagina>
      Mantenha todas as suas prioridades em dia.
    </app-descricao-pagina>
    <mat-card class="p-md-4">
      <mat-card-content>
        <form class="d-grid gap-2 fs-6 p-3" [formGroup]="formTarefa" (ngSubmit)="gravar()">
          <mat-form-field appearance="outline">
            <mat-label for="titulo">Título</mat-label>
            <input type="text" formControlName="titulo" matInput placeholder="Ex. Lavar o carro">
            <mat-error class="text-white" *ngIf="titulo?.touched && titulo?.invalid">
              <span *ngIf="titulo?.errors?.['minlength']">O título deve conter no mínimo 6 caracteres.</span>
              <span *ngIf="titulo?.errors?.['required']">O título é obrigatório.</span>
            </mat-error>
          </mat-form-field>
          <mat-label class="fs-5 my-2" for="prioridade">Prioridade</mat-label>
          <mat-radio-group class="row gap-2 fs-6" formControlName="prioridade">
            <mat-radio-button *ngFor="let prioridade of prioridades; index as i" [value]="i">{{prioridade}}</mat-radio-button>
            <mat-error class="text-white" *ngIf="prioridade?.touched && prioridade?.invalid">
              <span *ngIf="prioridade?.errors?.['required']">A prioridade é obrigatória.</span>
            </mat-error>
          </mat-radio-group>

          <section aria-label="Itens da Tarefa">
            <h2 class="fs-5 my-3">Itens da Tarefa</h2>
            <form class="d-grid gap-2" [formGroup]="formItens">
              <div class="row align-items-center">
                <mat-form-field class="col" appearance="outline">
                  <mat-label>Título do Item</mat-label>
                  <input type="text" formControlName="tituloItem" matInput placeholder="Ex. Pegar o balde d'água">
                  <mat-error class="text-white" *ngIf="titulo?.touched && titulo?.invalid">
                    <span *ngIf="titulo?.errors?.['minlength']">O título deve conter no mínimo 6 caracteres.</span>
                    <span *ngIf="titulo?.errors?.['required']">O título é obrigatório.</span>
                  </mat-error>
                </mat-form-field>
                <button
                  data-cy="btnAdicionarItem"
                  aria-label="Botão Adicionar Novo Item"
                  matTooltip="Adicionar Novo Item"
                  class="m-1"
                  (click)="adicionarItem()"
                  matSuffix
                  mat-mini-fab>
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </form>

            <table *ngIf="tarefaFormVM.itens.length > 0"  #tabelaItens class="w-100" mat-table [dataSource]="tarefaFormVM.itens">
              <ng-container matColumnDef="Título do Item">
                <th class="text-start fs-6 fw-bold" mat-header-cell *matHeaderCellDef>Título do Item</th>
                <td class="text-start fs-6" mat-cell *matCellDef="let item">{{item.titulo}}</td>
              </ng-container>

              <ng-container matColumnDef="Excluir">
                <th class="text-end text-md-end fs-6 fw-bold" mat-header-cell *matHeaderCellDef>Excluir</th>
                <td class="text-end text-md-end" mat-cell *matCellDef="let item">
                  <button type="button" (click)="removerItem(item)" class="col fs-6" mat-stroked-button color="accent">
                    <mat-icon class="">delete_forever</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="colunasExibidas"></tr>
              <tr mat-row *matRowDef="let row; columns: colunasExibidas;"></tr>
            </table>
          </section>
        </form>
      </mat-card-content>
      <mat-card-footer class="my-2">
        <div class="row px-4 gap-2">
          <button mat-stroked-button
            color="accent"
            class="col"
            type="button"
            routerLink="/tarefas/listar">
            <mat-icon>home</mat-icon>
            Voltar
          </button>
          <button mat-flat-button
            color="accent"
            class="col"
            data-cy="btnConfirmar"
            (click)="gravar()"
            type="button">
            <mat-icon>check</mat-icon>
            Confirmar
          </button>
        </div>
      </mat-card-footer>
    </mat-card>
  </section>
</div>
